openapi: 3.0.3
info:
  title: Constru√ß√£o de Software API
  version: 1.0.0
  description: |
    API para gerenciar usu√°rios, agendamentos e relat√≥rios semanais
    do sistema de agendamentos utilizado na disciplina Constru√ß√£o de Software.

    ## üîê Autentica√ß√£o (Ambiente Local ‚Äì Modo Dev)

    Em ambiente local, o Cognito est√° desativado.  
    Em seu lugar, o backend ativa automaticamente um filtro interno
    `LocalFakeJwtFilter`, permitindo testar as rotas autenticadas usando
    tokens simples enviados via header:

    Exemplos:
    - `Authorization: Bearer client` ‚Üí usu√°rio com ROLE_CLIENT
    - `Authorization: Bearer prof`   ‚Üí usu√°rio com ROLE_PROFESSIONAL
    - `Authorization: Bearer admin`  ‚Üí usu√°rio com ROLE_ADMIN

    Esse modo √© apenas para desenvolvimento local.  
    Em produ√ß√£o, a autentica√ß√£o usa Cognito + JWT real.

servers:
  - url: http://localhost:8080
    description: Servidor local

paths:
  /api/v1/users:
    get:
      summary: Lista todos os usu√°rios
      tags: [Users]
      responses:
        '200':
          description: Lista de usu√°rios
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserResponse'

    post:
      summary: Cria um novo usu√°rio
      tags: [Users]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRequest'
      responses:
        '201':
          description: Usu√°rio criado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'

  /api/v1/users/{email}:
    delete:
      summary: Deleta um usu√°rio pelo email
      tags: [Users]
      parameters:
        - name: email
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Removido com sucesso

  /api/v1/users/healthz:
    get:
      summary: Healthcheck da API
      tags: [Users]
      responses:
        '200':
          description: OK
          content:
            text/plain:
              schema:
                type: string
                example: Tudo j√≥ia chefia

  # ------------------------- APPOINTMENTS (CLIENTE) -------------------------

  /api/v1/appointments/create:
    post:
      summary: Cria um novo agendamento
      tags: [Appointments]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AppointmentRequest'
      responses:
        '201':
          description: Agendamento criado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppointmentResponse'

  /api/v1/appointments/list:
    get:
      summary: Lista os agendamentos do cliente autenticado
      tags: [Appointments]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista dos pr√≥prios agendamentos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AppointmentResponse'

  /api/v1/appointments/{id}/cancel:
    post:
      summary: Cancela um agendamento do cliente
      tags: [Appointments]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Cancelado com sucesso

  /api/v1/appointments/availability:
    get:
      summary: Consulta hor√°rios dispon√≠veis
      tags: [Appointments]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: providerId
          required: true
          schema:
            type: integer
        - in: query
          name: date
          required: true
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Disponibilidade retornada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AvailabilityResponse'

  # ------------------------- ADMIN -------------------------

  /api/v1/admin/appointments/list:
    get:
      summary: Lista agendamentos do prestador autenticado
      tags: [Admin Appointments]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de agendamentos do profissional
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AppointmentResponse'

  /api/v1/admin/appointments:
    get:
      summary: Lista paginada de agendamentos do sistema
      tags: [Admin Appointments]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
        - in: query
          name: size
          schema:
            type: integer
        - in: query
          name: status
          schema:
            type: string
            enum: [CREATED, CONFIRMED, CANCELED]
      responses:
        '200':
          description: Lista paginada
          content:
            application/json:
              schema:
                type: object
                properties:
                  content:
                    type: array
                    items:
                      $ref: '#/components/schemas/AppointmentResponse'
                  totalElements:
                    type: integer
                  totalPages:
                    type: integer
                  size:
                    type: integer
                  number:
                    type: integer

  /api/v1/admin/reports/week/report:
    get:
      summary: Gera relat√≥rio semanal
      tags: [Reports]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Chave do arquivo no S3
          content:
            text/plain:
              schema:
                type: string
                example: reports/weekly-2025-12-01.csv

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    UserRequest:
      type: object
      required: [name, email]
      properties:
        name:
          type: string
        email:
          type: string
          format: email

    UserResponse:
      type: object
      properties:
        name:
          type: string
        email:
          type: string
          format: email

    AppointmentRequest:
      type: object
      required: [providerId, start, end]
      properties:
        providerId:
          type: integer
        start:
          type: string
          format: date-time
        end:
          type: string
          format: date-time

    AppointmentResponse:
      type: object
      properties:
        id:
          type: integer
        providerName:
          type: string
        start:
          type: string
          format: date-time
        end:
          type: string
          format: date-time
        status:
          type: string

    AvailabilityResponse:
      type: object
      properties:
        providerId:
          type: integer
        date:
          type: string
          format: date
        availableTimes:
          type: array
          items:
            type: string
            example: "09:00"
